<!DOCTYPE html>
<html lang="en" data-bs-theme="{{ 'dark' if theme_settings.dark_mode_enabled else 'light' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project_name }} - System Theme</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: var(--bs-body-bg);
            color: var(--bs-body-color);
        }
        .container {
            margin-top: 30px;
            background-color: var(--bs-body-bg);
            color: var(--bs-body-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            border: 1px solid var(--bs-border-color);
        }
        .content-section {
            position: relative;
            overflow: hidden;
            background: var(--bs-secondary-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #6f42c1, #d63384);
        }
        .btn-purple {
            background: linear-gradient(135deg, #6f42c1, #d63384);
            border: none;
            color: white;
        }
        .btn-purple:hover {
            background: linear-gradient(135deg, #5a3399, #b02a5a);
            color: white;
        }
        .theme-preview {
            border: 2px solid var(--bs-border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--bs-body-bg);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .theme-preview:hover {
            border-color: #6f42c1;
            box-shadow: 0 2px 8px rgba(111, 66, 193, 0.15);
        }
        .theme-preview.selected {
            border-color: #6f42c1;
            background: rgba(111, 66, 193, 0.1);
        }
        .theme-preview.dark-theme {
            background: #212529;
            color: white;
        }
        .theme-preview.dark-theme:hover {
            border-color: #6f42c1;
        }
        .theme-preview.dark-theme.selected {
            background: rgba(111, 66, 193, 0.2);
        }
        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid var(--bs-border-color);
            display: inline-block;
            margin-right: 8px;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: var(--bs-body-bg);
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #6f42c1;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .preview-card {
            border: 1px solid var(--bs-border-color);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bs-body-bg);
        }
        .dark-preview .preview-card {
            background: #343a40;
            border-color: #495057;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-0">System Theme</h1>
                <p class="text-muted mb-0">Configure application theme and visual appearance</p>
            </div>
            <div>
                                <a href="{{ url_for('maintenance.maintenance_module_page') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Settings
                </a>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="alert d-none" role="alert"></div>

        <!-- Dark Mode Settings -->
        <div class="content-section">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-moon me-2"></i>Dark Mode
            </h5>
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h6>Enable Dark Mode</h6>
                    <p class="text-muted mb-0">Switch the entire application to a dark color scheme for better viewing in low-light environments</p>
                </div>
                <div class="col-md-4 text-end">
                    <label class="switch">
                        <input type="checkbox" id="darkModeToggle" {{ 'checked' if dark_mode_enabled else '' }}>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="mt-3">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Dark mode affects the main interface, entries, and content areas. Maintenance pages maintain their current styling.
                </small>
            </div>
        </div>

        <!-- Theme Selection -->
        <div class="content-section">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-palette me-2"></i>Color Theme
            </h5>
            <p class="text-muted mb-3">Choose the primary color scheme for the application interface</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="theme-preview" data-theme="default" onclick="selectTheme('default')">
                        <div class="d-flex align-items-center mb-2">
                            <div class="color-swatch" style="background: #0d6efd;"></div>
                            <div class="color-swatch" style="background: #198754;"></div>
                            <div class="color-swatch" style="background: #dc3545;"></div>
                            <h6 class="mb-0 ms-2">Default Blue</h6>
                        </div>
                        <div class="preview-card">
                            <small>Sample content with default theme colors</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="theme-preview" data-theme="emerald" onclick="selectTheme('emerald')">
                        <div class="d-flex align-items-center mb-2">
                            <div class="color-swatch" style="background: #10b981;"></div>
                            <div class="color-swatch" style="background: #059669;"></div>
                            <div class="color-swatch" style="background: #ef4444;"></div>
                            <h6 class="mb-0 ms-2">Emerald Green</h6>
                        </div>
                        <div class="preview-card">
                            <small>Sample content with emerald theme colors</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="theme-preview" data-theme="purple" onclick="selectTheme('purple')">
                        <div class="d-flex align-items-center mb-2">
                            <div class="color-swatch" style="background: #8b5cf6;"></div>
                            <div class="color-swatch" style="background: #7c3aed;"></div>
                            <div class="color-swatch" style="background: #ef4444;"></div>
                            <h6 class="mb-0 ms-2">Purple</h6>
                        </div>
                        <div class="preview-card">
                            <small>Sample content with purple theme colors</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="theme-preview" data-theme="amber" onclick="selectTheme('amber')">
                        <div class="d-flex align-items-center mb-2">
                            <div class="color-swatch" style="background: #f59e0b;"></div>
                            <div class="color-swatch" style="background: #d97706;"></div>
                            <div class="color-swatch" style="background: #ef4444;"></div>
                            <h6 class="mb-0 ms-2">Amber</h6>
                        </div>
                        <div class="preview-card">
                            <small>Sample content with amber theme colors</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="theme-preview" data-theme="custom" onclick="selectTheme('custom')">
                        <div class="d-flex align-items-center mb-2">
                            <div class="color-swatch" id="customPreviewPrimary" style="background: #0d6efd;"></div>
                            <div class="color-swatch" id="customPreviewSecondary" style="background: #6c757d;"></div>
                            <div class="color-swatch" id="customPreviewSuccess" style="background: #198754;"></div>
                            <h6 class="mb-0 ms-2">Custom</h6>
                        </div>
                        <div class="preview-card">
                            <small>Create your own color scheme</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Colors Section -->
        <div class="content-section" id="customColorsSection" style="display: none;">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-paint-brush me-2"></i>Custom Colors
            </h5>
            <p class="text-muted mb-3">Create your own color scheme by defining custom colors</p>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="customPrimary" class="form-label">Primary Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customPrimary" value="#0d6efd">
                        <input type="text" class="form-control" id="customPrimaryText" value="#0d6efd" placeholder="#000000">
                    </div>
                    <small class="text-muted">Main action buttons and links</small>
                </div>
                <div class="col-md-6">
                    <label for="customPrimaryHover" class="form-label">Primary Hover Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customPrimaryHover" value="#0b5ed7">
                        <input type="text" class="form-control" id="customPrimaryHoverText" value="#0b5ed7" placeholder="#000000">
                    </div>
                    <small class="text-muted">Hover state for primary elements</small>
                </div>
                <div class="col-md-6">
                    <label for="customSecondary" class="form-label">Secondary Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customSecondary" value="#6c757d">
                        <input type="text" class="form-control" id="customSecondaryText" value="#6c757d" placeholder="#000000">
                    </div>
                    <small class="text-muted">Secondary buttons and muted text</small>
                </div>
                <div class="col-md-6">
                    <label for="customSuccess" class="form-label">Success Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customSuccess" value="#198754">
                        <input type="text" class="form-control" id="customSuccessText" value="#198754" placeholder="#000000">
                    </div>
                    <small class="text-muted">Success messages and confirmations</small>
                </div>
                <div class="col-md-6">
                    <label for="customDanger" class="form-label">Danger Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customDanger" value="#dc3545">
                        <input type="text" class="form-control" id="customDangerText" value="#dc3545" placeholder="#000000">
                    </div>
                    <small class="text-muted">Error messages and delete buttons</small>
                </div>
                <div class="col-md-6">
                    <label for="customWarning" class="form-label">Warning Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customWarning" value="#ffc107">
                        <input type="text" class="form-control" id="customWarningText" value="#ffc107" placeholder="#000000">
                    </div>
                    <small class="text-muted">Warning messages and caution alerts</small>
                </div>
                <div class="col-md-6">
                    <label for="customInfo" class="form-label">Info Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="customInfo" value="#0dcaf0">
                        <input type="text" class="form-control" id="customInfoText" value="#0dcaf0" placeholder="#000000">
                    </div>
                    <small class="text-muted">Information messages and highlights</small>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-theme btn-sm" onclick="resetCustomColors()">
                        <i class="fas fa-undo me-1"></i>Reset to Defaults
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Light Mode Colors Section -->
        <div class="content-section" id="customLightModeSection" style="display: none;">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-sun me-2"></i>Light Mode Customization
            </h5>
            <p class="text-muted mb-3">Customize the appearance of light mode interface elements</p>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="lightModeBgBody" class="form-label">Background Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeBgBody" value="#ffffff">
                        <input type="text" class="form-control" id="lightModeBgBodyText" value="#ffffff" placeholder="#ffffff">
                    </div>
                    <small class="text-muted">Main page background</small>
                </div>
                <div class="col-md-6">
                    <label for="lightModeBgCard" class="form-label">Card Background</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeBgCard" value="#ffffff">
                        <input type="text" class="form-control" id="lightModeBgCardText" value="#ffffff" placeholder="#ffffff">
                    </div>
                    <small class="text-muted">Content cards and containers</small>
                </div>
                <div class="col-md-6">
                    <label for="lightModeBgSurface" class="form-label">Surface Background</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeBgSurface" value="#f8f9fa">
                        <input type="text" class="form-control" id="lightModeBgSurfaceText" value="#f8f9fa" placeholder="#f8f9fa">
                    </div>
                    <small class="text-muted">Secondary surfaces and form elements</small>
                </div>
                <div class="col-md-6">
                    <label for="lightModeText" class="form-label">Text Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeText" value="#212529">
                        <input type="text" class="form-control" id="lightModeTextText" value="#212529" placeholder="#212529">
                    </div>
                    <small class="text-muted">Primary text and headings</small>
                </div>
                <div class="col-md-6">
                    <label for="lightModeTextMuted" class="form-label">Muted Text Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeTextMuted" value="#6c757d">
                        <input type="text" class="form-control" id="lightModeTextMutedText" value="#6c757d" placeholder="#6c757d">
                    </div>
                    <small class="text-muted">Secondary text and descriptions</small>
                </div>
                <div class="col-md-6">
                    <label for="lightModeBorder" class="form-label">Border Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="lightModeBorder" value="#dee2e6">
                        <input type="text" class="form-control" id="lightModeBorderText" value="#dee2e6" placeholder="#dee2e6">
                    </div>
                    <small class="text-muted">Borders and dividers</small>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-theme btn-sm" onclick="resetLightModeColors()">
                        <i class="fas fa-undo me-1"></i>Reset to Defaults
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Dark Mode Colors Section -->
        <div class="content-section" id="customDarkModeSection" style="display: none;">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-moon me-2"></i>Dark Mode Customization
            </h5>
            <p class="text-muted mb-3">Customize the appearance of dark mode interface elements</p>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="darkModeBgBody" class="form-label">Background Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeBgBody" value="#0d1117">
                        <input type="text" class="form-control" id="darkModeBgBodyText" value="#0d1117" placeholder="#0d1117">
                    </div>
                    <small class="text-muted">Main page background</small>
                </div>
                <div class="col-md-6">
                    <label for="darkModeBgCard" class="form-label">Card Background</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeBgCard" value="#161b22">
                        <input type="text" class="form-control" id="darkModeBgCardText" value="#161b22" placeholder="#161b22">
                    </div>
                    <small class="text-muted">Content cards and containers</small>
                </div>
                <div class="col-md-6">
                    <label for="darkModeBgSurface" class="form-label">Surface Background</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeBgSurface" value="#21262d">
                        <input type="text" class="form-control" id="darkModeBgSurfaceText" value="#21262d" placeholder="#21262d">
                    </div>
                    <small class="text-muted">Secondary surfaces and form elements</small>
                </div>
                <div class="col-md-6">
                    <label for="darkModeText" class="form-label">Text Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeText" value="#f0f6fc">
                        <input type="text" class="form-control" id="darkModeTextText" value="#f0f6fc" placeholder="#f0f6fc">
                    </div>
                    <small class="text-muted">Primary text and headings</small>
                </div>
                <div class="col-md-6">
                    <label for="darkModeTextMuted" class="form-label">Muted Text Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeTextMuted" value="#8b949e">
                        <input type="text" class="form-control" id="darkModeTextMutedText" value="#8b949e" placeholder="#8b949e">
                    </div>
                    <small class="text-muted">Secondary text and descriptions</small>
                </div>
                <div class="col-md-6">
                    <label for="darkModeBorder" class="form-label">Border Color</label>
                    <div class="input-group">
                        <input type="color" class="form-control form-control-color" id="darkModeBorder" value="#30363d">
                        <input type="text" class="form-control" id="darkModeBorderText" value="#30363d" placeholder="#30363d">
                    </div>
                    <small class="text-muted">Borders and dividers</small>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-theme btn-sm" onclick="resetDarkModeColors()">
                        <i class="fas fa-undo me-1"></i>Reset to Defaults
                    </button>
                </div>
            </div>
        </div>

        <!-- Font Size Settings -->
        <div class="content-section">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-text-height me-2"></i>Font Size
            </h5>
            <div class="row">
                <div class="col-md-6">
                    <label for="fontSize" class="form-label">Base Font Size</label>
                    <select class="form-select" id="fontSize">
                        <option value="small" {{ 'selected' if font_size == 'small' else '' }}>Small (14px)</option>
                        <option value="normal" {{ 'selected' if font_size == 'normal' or not font_size else '' }}>Normal (16px)</option>
                        <option value="large" {{ 'selected' if font_size == 'large' else '' }}>Large (18px)</option>
                        <option value="extra-large" {{ 'selected' if font_size == 'extra-large' else '' }}>Extra Large (20px)</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Preview</label>
                    <div class="border rounded p-3" id="fontPreview" style="background: rgba(111, 66, 193, 0.1); border-color: rgba(111, 66, 193, 0.3) !important;">
                        <p class="mb-0">This is how text will appear with your selected font size.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- High Contrast Settings -->
        <div class="content-section">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-eye me-2"></i>Accessibility
            </h5>
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h6>High Contrast Mode</h6>
                    <p class="text-muted mb-0">Increase contrast for better visibility and accessibility</p>
                </div>
                <div class="col-md-4 text-end">
                    <label class="switch">
                        <input type="checkbox" id="highContrastToggle" {{ 'checked' if high_contrast_enabled else '' }}>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Section Styling Settings -->
        <div class="content-section">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-layer-group me-2"></i>Section Styling
            </h5>
            <p class="text-muted mb-3">Customize the appearance of content sections, cards, and containers</p>
            
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="sectionBorderStyle" class="form-label">Border Style</label>
                    <select class="form-select" id="sectionBorderStyle">
                        <option value="rounded">Rounded (Default)</option>
                        <option value="sharp">Sharp Corners</option>
                        <option value="subtle">Subtle Rounded</option>
                        <option value="bold">Bold Rounded</option>
                    </select>
                    <small class="text-muted">Controls the border radius of sections</small>
                </div>
                
                <div class="col-md-4">
                    <label for="sectionSpacing" class="form-label">Section Spacing</label>
                    <select class="form-select" id="sectionSpacing">
                        <option value="compact">Compact</option>
                        <option value="normal">Normal (Default)</option>
                        <option value="spacious">Spacious</option>
                    </select>
                    <small class="text-muted">Controls padding and margins</small>
                </div>
                
                <div class="col-md-4">
                    <label for="sectionBackground" class="form-label">Background Style</label>
                    <select class="form-select" id="sectionBackground">
                        <option value="flat">Flat</option>
                        <option value="subtle">Subtle (Default)</option>
                        <option value="elevated">Elevated</option>
                        <option value="glassmorphic">Glassmorphic</option>
                    </select>
                    <small class="text-muted">Controls shadow and background effects</small>
                </div>
            </div>
            
            <div class="row g-3 mt-2">
                <div class="col-md-6">
                    <label for="sectionAnimation" class="form-label">Animation Effect</label>
                    <select class="form-select" id="sectionAnimation">
                        <option value="none">None (Default)</option>
                        <option value="fade">Fade In</option>
                        <option value="slide">Slide Up</option>
                        <option value="bounce">Bounce In</option>
                        <option value="pulse">Pulse (Continuous)</option>
                    </select>
                    <small class="text-muted">Entrance animation for sections</small>
                </div>
                
                <div class="col-md-6">
                    <label for="sectionEffect" class="form-label">Visual Effect</label>
                    <select class="form-select" id="sectionEffect">
                        <option value="none">None (Default)</option>
                        <option value="glow">Glow Effect</option>
                        <option value="shadow">Enhanced Shadow</option>
                        <option value="gradient">Gradient Overlay</option>
                        <option value="texture">Subtle Texture</option>
                    </select>
                    <small class="text-muted">Additional visual enhancements</small>
                </div>
            </div>
            
            <div class="mt-4">
                <label class="form-label">Section Style Preview</label>
                <div class="preview-card section-style-preview" id="sectionStylePreview" style="border: 1px solid var(--bs-border-color); border-radius: 0.75rem; padding: 1.5rem; background: var(--bs-body-bg); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-info-circle text-primary me-2"></i>
                        <h6 class="mb-0">Sample Section</h6>
                    </div>
                    <p class="text-muted mb-3">This shows how content sections will appear with your selected styling options.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <span class="badge bg-primary">Sample Badge</span>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-outline-primary btn-sm">Sample Button</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="content-section" id="livePreview">
            <h5 class="mb-3" style="color: #6f42c1;">
                <i class="fas fa-eye me-2"></i>Live Preview
            </h5>
            <p class="text-muted mb-3">Preview how your theme settings will look across different UI elements</p>
            
            <div class="preview-container" id="previewContainer">
                <!-- Main Content Card -->
                <div class="preview-card mb-4" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h4 class="mb-1" style="color: var(--bs-body-color);">Sample Entry Title</h4>
                            <p class="text-muted mb-2">This demonstrates how content will appear with your theme settings</p>
                            <small class="text-muted">Created: January 15, 2025 | Updated: 2 hours ago</small>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-copy me-2"></i>Duplicate</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Status Badges -->
                    <div class="d-flex gap-2 mb-3">
                        <span class="badge bg-primary">Primary</span>
                        <span class="badge bg-success">Success</span>
                        <span class="badge bg-warning text-dark">Warning</span>
                        <span class="badge bg-danger">Danger</span>
                        <span class="badge bg-info text-dark">Info</span>
                        <span class="badge bg-secondary">Secondary</span>
                    </div>
                    
                    <!-- Sample Content -->
                    <div class="mb-3">
                        <p style="color: var(--bs-body-color);">This is sample content that shows how regular text appears with your chosen theme. The text should be clearly readable and provide good contrast against the background.</p>
                        <blockquote class="blockquote text-muted ps-3" style="border-left: 3px solid var(--bs-primary);">
                            "This is a sample quote demonstrating how highlighted content appears in your theme."
                        </blockquote>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary">Primary Action</button>
                        <button class="btn btn-outline-primary">Secondary Action</button>
                        <button class="btn btn-success">Save</button>
                        <button class="btn btn-outline-danger">Cancel</button>
                    </div>
                </div>
                
                <!-- Form Elements Preview -->
                <div class="preview-card mb-4" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Form Elements</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="previewInput" class="form-label">Text Input</label>
                                <input type="text" class="form-control" id="previewInput" placeholder="Enter text here..." value="Sample input text">
                            </div>
                            <div class="mb-3">
                                <label for="previewSelect" class="form-label">Select Dropdown</label>
                                <select class="form-select" id="previewSelect">
                                    <option selected>Choose an option...</option>
                                    <option value="1">Option One</option>
                                    <option value="2">Option Two</option>
                                    <option value="3">Option Three</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="previewTextarea" class="form-label">Textarea</label>
                                <textarea class="form-control" id="previewTextarea" rows="3" placeholder="Enter multiple lines of text...">This is sample textarea content showing how multi-line input fields appear with your theme.</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkboxes and Radio Buttons -->
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Checkbox Options</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="check1" checked>
                                <label class="form-check-label" for="check1">Option 1 (checked)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="check2">
                                <label class="form-check-label" for="check2">Option 2</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Radio Button Options</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="radioPreview" id="radio1" checked>
                                <label class="form-check-label" for="radio1">Radio Option 1</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="radioPreview" id="radio2">
                                <label class="form-check-label" for="radio2">Radio Option 2</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tables Preview -->
                <div class="preview-card mb-4" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Data Tables</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">1</th>
                                    <td>Sample Entry One</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>2025-01-15</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                        <button class="btn btn-sm btn-outline-secondary">Edit</button>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">2</th>
                                    <td>Sample Entry Two</td>
                                    <td><span class="badge bg-warning text-dark">Pending</span></td>
                                    <td>2025-01-14</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                        <button class="btn btn-sm btn-outline-secondary">Edit</button>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">3</th>
                                    <td>Sample Entry Three</td>
                                    <td><span class="badge bg-danger">Inactive</span></td>
                                    <td>2025-01-13</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                        <button class="btn btn-sm btn-outline-secondary">Edit</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Alerts and Messages -->
                <div class="preview-card mb-4" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Alerts & Messages</h5>
                    <div class="alert alert-primary" role="alert">
                        <i class="fas fa-info-circle me-2"></i>This is a primary alert with some sample text.
                    </div>
                    <div class="alert alert-success" role="alert">
                        <i class="fas fa-check-circle me-2"></i>This is a success alert indicating something good happened.
                    </div>
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>This is a warning alert that needs attention.
                    </div>
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-times-circle me-2"></i>This is a danger alert indicating an error occurred.
                    </div>
                </div>
                
                <!-- Navigation and Tabs -->
                <div class="preview-card mb-4" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Navigation Elements</h5>
                    
                    <!-- Navigation Pills -->
                    <div class="mb-3">
                        <h6 class="mb-2">Navigation Pills</h6>
                        <ul class="nav nav-pills">
                            <li class="nav-item">
                                <a class="nav-link active" href="#">Active</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Link</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Another Link</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" tabindex="-1">Disabled</a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Tab Navigation -->
                    <div class="mb-3">
                        <h6 class="mb-2">Tab Navigation</h6>
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" href="#">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Profile</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Messages</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" tabindex="-1">Disabled</a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Pagination -->
                    <div>
                        <h6 class="mb-2">Pagination</h6>
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                
                <!-- Progress and Loading Elements -->
                <div class="preview-card" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Progress & Loading</h5>
                    
                    <!-- Progress Bars -->
                    <div class="mb-3">
                        <h6 class="mb-2">Progress Indicators</h6>
                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                        </div>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                        </div>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">75%</div>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100">90%</div>
                        </div>
                    </div>
                    
                    <!-- Spinners -->
                    <div>
                        <h6 class="mb-2">Loading Spinners</h6>
                        <div class="d-flex gap-3 align-items-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="spinner-grow text-warning" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="spinner-grow text-danger" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Interactive Chart Preview -->
                <div class="preview-card" style="border: 1px solid var(--bs-border-color); border-radius: 8px; padding: 1.5rem; background: var(--bs-body-bg);">
                    <h5 class="mb-3" style="color: var(--bs-body-color);">Interactive Chart Preview</h5>
                    <p class="text-muted mb-3">This chart updates in real-time with your theme changes.</p>
                    
                    <!-- Chart Controls -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="previewChartType" class="form-label">Chart Type</label>
                            <select class="form-select form-select-sm" id="previewChartType">
                                <option value="line">Line Chart</option>
                                <option value="bar">Bar Chart</option>
                                <option value="area">Area Chart</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="previewDataSet" class="form-label">Data Set</label>
                            <select class="form-select form-select-sm" id="previewDataSet">
                                <option value="temperature">Temperature</option>
                                <option value="humidity">Humidity</option>
                                <option value="pressure">Pressure</option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-primary btn-sm me-2" onclick="updatePreviewChart()">
                                <i class="fas fa-sync me-1"></i>Refresh
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="resetPreviewChart()">
                                <i class="fas fa-undo me-1"></i>Reset
                            </button>
                        </div>
                    </div>

                    <!-- Chart Canvas -->
                    <div class="position-relative">
                        <canvas id="themePreviewChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Chart Legend -->
                    <div class="mt-3 d-flex justify-content-center flex-wrap">
                        <span class="badge bg-primary me-2 mb-1">Primary Color</span>
                        <span class="badge bg-success me-2 mb-1">Success</span>
                        <span class="badge bg-warning me-2 mb-1">Warning</span>
                        <span class="badge bg-danger me-2 mb-1">Danger</span>
                        <span class="badge bg-info mb-1">Info</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="text-end">
            <button type="button" class="btn btn-purple btn-lg" onclick="saveThemeSettings()">
                <i class="fas fa-save me-2"></i>Save Theme Settings
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let selectedTheme = '{{ current_theme or "default" }}';
        let customColors = {};
        let sectionStyles = {
            border_style: 'rounded',
            spacing: 'normal',
            background: 'subtle'
        };
        
        // Load section styles if available
        {% if section_styles %}
        sectionStyles = {{ section_styles|tojson }};
        {% endif %}
        
        // Load custom colors if available
        {% if custom_colors %}
        customColors = {{ custom_colors|tojson }};
        {% endif %}
        
        let customLightMode = {};
        let customDarkMode = {};
        
        // Load custom light/dark mode colors if available
        {% if custom_light_mode %}
        customLightMode = {{ custom_light_mode|tojson }};
        {% endif %}
        
        {% if custom_dark_mode %}
        customDarkMode = {{ custom_dark_mode|tojson }};
        {% endif %}
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize theme selection
            selectTheme(selectedTheme);
            updateFontPreview();
            updateLivePreview();
            loadCustomColors();
            loadCustomLightModeColors();
            loadCustomDarkModeColors();
            loadSectionStyles();
            setupCustomColorEventListeners();
            setupLightModeEventListeners();
            setupDarkModeEventListeners();
            setupSectionStyleEventListeners();
            
            // Initialize preview chart
            initializePreviewChart();
            
            // Add event listeners
            document.getElementById('darkModeToggle').addEventListener('change', updateLivePreview);
            document.getElementById('fontSize').addEventListener('change', updateFontPreview);
            document.getElementById('fontSize').addEventListener('change', updateLivePreview);
            document.getElementById('highContrastToggle').addEventListener('change', updateLivePreview);
            
            // Chart control event listeners
            document.getElementById('previewChartType').addEventListener('change', updatePreviewChart);
            document.getElementById('previewDataSet').addEventListener('change', updatePreviewChart);
        });
        
        
        // Preview Chart Variables
        let previewChart = null;
        
        // Chart initialization and management
        function initializePreviewChart() {
            const canvas = document.getElementById('themePreviewChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart if it exists
            if (previewChart) {
                previewChart.destroy();
                previewChart = null;
            }
            
            // Generate sample data
            const sampleData = generateSampleChartData();
            
            // Get current theme colors from theme state (like entry_detail.html)
            const colors = getCurrentThemeColors();
            
            // Use the same approach as entry_detail.html for color generation
            function hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // Get the primary color from current theme (exactly like entry_detail.html)
            const primaryColor = colors.primary;
            
            previewChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sampleData.labels,
                    datasets: [{
                        label: 'Temperature',
                        data: sampleData.temperature,
                        borderColor: colors.primary,
                        backgroundColor: hexToRgba(colors.primary, 0.2),
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Humidity',
                        data: sampleData.humidity,
                        borderColor: colors.success,
                        backgroundColor: hexToRgba(colors.success, 0.2),
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    }, {
                        label: 'Pressure',
                        data: sampleData.pressure,
                        borderColor: colors.warning,
                        backgroundColor: hexToRgba(colors.warning, 0.2),
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    color: primaryColor, // Set default text color to primary theme color (exactly like entry_detail.html)
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sensor Data Preview',
                            color: primaryColor, // Use primary color for title (exactly like entry_detail.html)
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            labels: {
                                color: primaryColor, // Use primary color for legend (exactly like entry_detail.html)
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time',
                                color: primaryColor // Use primary color for axis titles (exactly like entry_detail.html)
                            },
                            ticks: {
                                color: hexToRgba(primaryColor, 0.7) // Use primary with alpha for ticks (exactly like entry_detail.html)
                            },
                            grid: {
                                color: hexToRgba(primaryColor, 0.2) // Use primary with alpha for grid (exactly like entry_detail.html)
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Value',
                                color: primaryColor // Use primary color for axis titles (exactly like entry_detail.html)
                            },
                            ticks: {
                                color: hexToRgba(primaryColor, 0.7) // Use primary with alpha for ticks (exactly like entry_detail.html)
                            },
                            grid: {
                                color: hexToRgba(primaryColor, 0.2) // Use primary with alpha for grid (exactly like entry_detail.html)
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        function generateSampleChartData() {
            const labels = [];
            const temperature = [];
            const humidity = [];
            const pressure = [];
            
            // Generate 24 hours of sample data
            const now = new Date();
            for (let i = 23; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                
                // Generate realistic sensor data with some randomness
                temperature.push(20 + Math.sin(i * 0.3) * 5 + Math.random() * 2);
                humidity.push(50 + Math.cos(i * 0.2) * 20 + Math.random() * 5);
                pressure.push(1013 + Math.sin(i * 0.1) * 10 + Math.random() * 3);
            }
            
            return { labels, temperature, humidity, pressure };
        }
        
        function getCurrentThemeColors() {
            // Get colors dynamically from current theme state, not just CSS variables
            let primaryColor = '#0d6efd';
            let successColor = '#198754';
            let warningColor = '#ffc107';
            let dangerColor = '#dc3545';
            let infoColor = '#0dcaf0';
            
            // Theme color schemes
            const themeColors = {
                'default': {
                    primary: '#0d6efd',
                    success: '#198754',
                    warning: '#ffc107',
                    danger: '#dc3545',
                    info: '#0dcaf0'
                },
                'emerald': {
                    primary: '#10b981',
                    success: '#22c55e',
                    warning: '#f59e0b',
                    danger: '#ef4444',
                    info: '#06b6d4'
                },
                'purple': {
                    primary: '#8b5cf6',
                    success: '#22c55e',
                    warning: '#f59e0b',
                    danger: '#ef4444',
                    info: '#06b6d4'
                },
                'amber': {
                    primary: '#f59e0b',
                    success: '#22c55e',
                    warning: '#eab308',
                    danger: '#ef4444',
                    info: '#06b6d4'
                }
            };
            
            // Get current colors based on selected theme
            if (selectedTheme === 'custom') {
                // Use custom colors if available
                primaryColor = document.getElementById('customPrimary')?.value || primaryColor;
                successColor = document.getElementById('customSuccess')?.value || successColor;
                warningColor = document.getElementById('customWarning')?.value || warningColor;
                dangerColor = document.getElementById('customDanger')?.value || dangerColor;
                infoColor = document.getElementById('customInfo')?.value || infoColor;
            } else if (themeColors[selectedTheme]) {
                const colors = themeColors[selectedTheme];
                primaryColor = colors.primary;
                successColor = colors.success;
                warningColor = colors.warning;
                dangerColor = colors.danger;
                infoColor = colors.info;
            }
                        
            // Get text colors from CSS variables (like entry_detail.html does)
            const computedStyle = getComputedStyle(document.documentElement);
            const text = computedStyle.getPropertyValue('--theme-text').trim() || 
                        computedStyle.getPropertyValue('--bs-body-color').trim() || '#212529';
            const textMuted = computedStyle.getPropertyValue('--theme-text-muted').trim() || 
                             computedStyle.getPropertyValue('--bs-secondary').trim() || '#6c757d';
            const border = computedStyle.getPropertyValue('--theme-border').trim() || 
                          computedStyle.getPropertyValue('--bs-border-color').trim() || '#dee2e6';
            
            return {
                primary: primaryColor,
                success: successColor,
                warning: warningColor,
                danger: dangerColor,
                info: infoColor,
                text: text,
                textMuted: textMuted,
                border: border,
            };
        }
        
        // Global helper function for hex to rgba conversion
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        function updatePreviewChart() {
            if (!previewChart) {
                initializePreviewChart();
                return;
            }
            
            const chartType = document.getElementById('previewChartType').value;
            const dataSet = document.getElementById('previewDataSet').value;
            
            // Change chart type
            previewChart.config.type = chartType;
            
            // Update colors using current theme state (like entry_detail.html)
            const colors = getCurrentThemeColors();
            
            // Helper function to create rgba colors (same as entry_detail.html)
            function hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // Update dataset visibility based on selected data
            previewChart.data.datasets.forEach((dataset, index) => {
                const datasetNames = ['temperature', 'humidity', 'pressure'];
                if (dataSet === 'all' || datasetNames[index] === dataSet) {
                    dataset.hidden = false;
                } else {
                    dataset.hidden = true;
                }
                
                // Update colors (same approach as entry_detail.html)
                switch(index) {
                    case 0: // Temperature
                        dataset.borderColor = colors.primary;
                        dataset.backgroundColor = chartType === 'line' ? hexToRgba(colors.primary, 0.2) : colors.primary;
                        break;
                    case 1: // Humidity
                        dataset.borderColor = colors.success;
                        dataset.backgroundColor = chartType === 'line' ? hexToRgba(colors.success, 0.2) : colors.success;
                        break;
                    case 2: // Pressure
                        dataset.borderColor = colors.warning;
                        dataset.backgroundColor = chartType === 'line' ? hexToRgba(colors.warning, 0.2) : colors.warning;
                        break;
                }
            });
            
            // Update chart options using primaryColor for text (exactly like entry_detail.html)
            const primaryColor = colors.primary; // Use the primary color from current theme
            
            previewChart.options.color = primaryColor; // Update default text color
            previewChart.options.plugins.title.color = primaryColor; // Use primary color for title (like entry_detail.html)
            previewChart.options.plugins.legend.labels.color = primaryColor; // Use primary color for legend (like entry_detail.html)
            previewChart.options.scales.x.title.color = primaryColor; // Use primary color for axis titles (like entry_detail.html)
            previewChart.options.scales.x.ticks.color = hexToRgba(primaryColor, 0.7); // Use primary with alpha for ticks (like entry_detail.html)
            previewChart.options.scales.x.grid.color = hexToRgba(primaryColor, 0.2); // Use primary with alpha for grid (like entry_detail.html)
            previewChart.options.scales.y.title.color = primaryColor; // Use primary color for axis titles (like entry_detail.html)
            previewChart.options.scales.y.ticks.color = hexToRgba(primaryColor, 0.7); // Use primary with alpha for ticks (like entry_detail.html)
            previewChart.options.scales.y.grid.color = hexToRgba(primaryColor, 0.2); // Use primary with alpha for grid (like entry_detail.html)
            
            previewChart.update('active');
        }
        
        function resetPreviewChart() {
            // Reset to default settings
            document.getElementById('previewChartType').value = 'line';
            document.getElementById('previewDataSet').value = 'temperature';
            updatePreviewChart();
        }
        
        function selectTheme(theme) {
            selectedTheme = theme;
            
            // Update theme selection UI
            document.querySelectorAll('.theme-preview').forEach(preview => {
                preview.classList.remove('selected');
            });
            document.querySelector(`[data-theme="${theme}"]`).classList.add('selected');
            
            // Show/hide custom sections
            const customSection = document.getElementById('customColorsSection');
            const lightModeSection = document.getElementById('customLightModeSection');
            const darkModeSection = document.getElementById('customDarkModeSection');
            
            if (theme === 'custom') {
                customSection.style.display = 'block';
                lightModeSection.style.display = 'block';
                darkModeSection.style.display = 'block';
            } else {
                customSection.style.display = 'none';
                lightModeSection.style.display = 'none';
                darkModeSection.style.display = 'none';
            }
            
            updateLivePreview();
            
            // Update chart with new theme
            if (previewChart) {
                updatePreviewChart();
            }
        }
        
        function loadCustomColors() {
            if (Object.keys(customColors).length > 0) {
                // Load existing custom colors
                Object.entries(customColors).forEach(([key, value]) => {
                    const colorInput = document.getElementById('custom' + key.charAt(0).toUpperCase() + key.slice(1).replace('_', ''));
                    const textInput = document.getElementById('custom' + key.charAt(0).toUpperCase() + key.slice(1).replace('_', '') + 'Text');
                    if (colorInput && textInput) {
                        colorInput.value = value;
                        textInput.value = value;
                    }
                });
                updateCustomPreview();
            }
        }

        function loadCustomLightModeColors() {
            if (Object.keys(customLightMode).length > 0) {
                // Load existing custom light mode colors
                Object.entries(customLightMode).forEach(([key, value]) => {
                    // Convert snake_case to proper ID format (e.g., 'bg_body' -> 'lightModeBgBody')
                    const elementName = key.charAt(0).toUpperCase() + key.slice(1).replace(/_([a-z])/g, (match, letter) => letter.toUpperCase());
                    const colorInput = document.getElementById('lightMode' + elementName);
                    const textInput = document.getElementById('lightMode' + elementName + 'Text');
                    if (colorInput && textInput) {
                        colorInput.value = value;
                        textInput.value = value;
                    }
                });
                updateLightModePreview();
            }
        }

        function loadCustomDarkModeColors() {
            if (Object.keys(customDarkMode).length > 0) {
                // Load existing custom dark mode colors
                Object.entries(customDarkMode).forEach(([key, value]) => {
                    // Convert snake_case to proper ID format (e.g., 'bg_body' -> 'darkModeBgBody')
                    const elementName = key.charAt(0).toUpperCase() + key.slice(1).replace(/_([a-z])/g, (match, letter) => letter.toUpperCase());
                    const colorInput = document.getElementById('darkMode' + elementName);
                    const textInput = document.getElementById('darkMode' + elementName + 'Text');
                    if (colorInput && textInput) {
                        colorInput.value = value;
                        textInput.value = value;
                    }
                });
                updateDarkModePreview();
            }
        }
        
        function loadSectionStyles() {
            // Load section style selections
            document.getElementById('sectionBorderStyle').value = sectionStyles.border_style || 'rounded';
            document.getElementById('sectionSpacing').value = sectionStyles.spacing || 'normal';
            document.getElementById('sectionBackground').value = sectionStyles.background || 'subtle';
            document.getElementById('sectionAnimation').value = sectionStyles.animation || 'none';
            document.getElementById('sectionEffect').value = sectionStyles.effect || 'none';
            updateSectionStylePreview();
        }
        
        function setupSectionStyleEventListeners() {
            // Section border style
            document.getElementById('sectionBorderStyle').addEventListener('change', function() {
                sectionStyles.border_style = this.value;
                updateSectionStylePreview();
                updateLivePreview();
            });
            
            // Section spacing
            document.getElementById('sectionSpacing').addEventListener('change', function() {
                sectionStyles.spacing = this.value;
                updateSectionStylePreview();
                updateLivePreview();
            });
            
            // Section background
            document.getElementById('sectionBackground').addEventListener('change', function() {
                sectionStyles.background = this.value;
                updateSectionStylePreview();
                updateLivePreview();
            });
            
            // Section animation
            document.getElementById('sectionAnimation').addEventListener('change', function() {
                sectionStyles.animation = this.value;
                updateSectionStylePreview();
                updateLivePreview();
            });
            
            // Section effect
            document.getElementById('sectionEffect').addEventListener('change', function() {
                sectionStyles.effect = this.value;
                updateSectionStylePreview();
                updateLivePreview();
            });
        }
        
        function updateSectionStylePreview() {
            const preview = document.getElementById('sectionStylePreview');
            if (!preview) return;
            
            // Border radius values
            const borderRadiusMap = {
                'rounded': '0.75rem',
                'sharp': '0',
                'subtle': '0.375rem',
                'bold': '1.25rem'
            };
            
            // Spacing values
            const spacingMap = {
                'compact': '1rem',
                'normal': '1.5rem',
                'spacious': '2rem'
            };
            
            // Background styles
            const isDarkMode = document.getElementById('darkModeToggle').checked;
            let background, border, shadow;
            
            switch (sectionStyles.background) {
                case 'flat':
                    background = isDarkMode ? '#0d1117' : '#ffffff';
                    border = 'transparent';
                    shadow = 'none';
                    break;
                case 'elevated':
                    background = isDarkMode ? '#1f2428' : '#fdfdfd';
                    border = isDarkMode ? '#3d444d' : '#c1c8cd';
                    shadow = isDarkMode ? '0 4px 12px rgba(0, 0, 0, 0.4)' : '0 4px 12px rgba(0, 0, 0, 0.15)';
                    break;
                case 'glassmorphic':
                    background = isDarkMode ? 'rgba(31, 36, 40, 0.8)' : 'rgba(255, 255, 255, 0.9)';
                    border = isDarkMode ? '#48515a' : '#a1a8ad';
                    shadow = isDarkMode ? '0 8px 32px rgba(0, 0, 0, 0.3)' : '0 8px 32px rgba(0, 0, 0, 0.1)';
                    break;
                default: // subtle
                    background = isDarkMode ? '#161b22' : '#ffffff';
                    border = isDarkMode ? '#30363d' : '#dee2e6';
                    shadow = isDarkMode ? '0 1px 3px rgba(0, 0, 0, 0.2)' : '0 1px 3px rgba(0, 0, 0, 0.1)';
            }
            
            // Apply styles
            preview.style.borderRadius = borderRadiusMap[sectionStyles.border_style];
            preview.style.padding = spacingMap[sectionStyles.spacing];
            preview.style.background = background;
            preview.style.border = `1px solid ${border}`;
            preview.style.boxShadow = shadow;
            
            if (sectionStyles.background === 'glassmorphic') {
                preview.style.backdropFilter = 'blur(8px)';
                preview.style.webkitBackdropFilter = 'blur(8px)';
            } else {
                preview.style.backdropFilter = 'none';
                preview.style.webkitBackdropFilter = 'none';
            }
        }
        
        function setupCustomColorEventListeners() {
            const colorInputs = ['Primary', 'PrimaryHover', 'Secondary', 'Success', 'Danger', 'Warning', 'Info'];
            
            colorInputs.forEach(color => {
                const colorInput = document.getElementById('custom' + color);
                const textInput = document.getElementById('custom' + color + 'Text');
                
                if (colorInput && textInput) {
                    // Sync color picker with text input
                    colorInput.addEventListener('input', (e) => {
                        textInput.value = e.target.value;
                        updateCustomPreview();
                        updateLivePreview(); // Update live preview
                        if (previewChart) updatePreviewChart(); // Update chart
                    });
                    
                    // Sync text input with color picker
                    textInput.addEventListener('input', (e) => {
                        if (isValidHexColor(e.target.value)) {
                            colorInput.value = e.target.value;
                            updateCustomPreview();
                            updateLivePreview(); // Update live preview
                            if (previewChart) updatePreviewChart(); // Update chart
                        }
                    });
                }
            });
        }
        
        function isValidHexColor(hex) {
            return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
        }
        
        function updateCustomPreview() {
            const primary = document.getElementById('customPrimary').value;
            const secondary = document.getElementById('customSecondary').value;
            const success = document.getElementById('customSuccess').value;
            
            document.getElementById('customPreviewPrimary').style.background = primary;
            document.getElementById('customPreviewSecondary').style.background = secondary;
            document.getElementById('customPreviewSuccess').style.background = success;
        }
        
        function resetCustomColors() {
            const defaults = {
                'customPrimary': '#0d6efd',
                'customPrimaryHover': '#0b5ed7',
                'customSecondary': '#6c757d',
                'customSuccess': '#198754',
                'customDanger': '#dc3545',
                'customWarning': '#ffc107',
                'customInfo': '#0dcaf0'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                document.getElementById(id).value = value;
                document.getElementById(id + 'Text').value = value;
            });
            
            updateCustomPreview();
        }

        function resetLightModeColors() {
            const defaults = {
                'lightBgbody': '#ffffff',
                'lightBgcard': '#ffffff', 
                'lightBgsurface': '#f8f9fa',
                'lightText': '#212529',
                'lightTextmuted': '#6c757d',
                'lightBorder': '#dee2e6'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                document.getElementById(id).value = value;
                document.getElementById(id + 'Text').value = value;
            });
            
            updateLightModePreview();
        }

        function resetDarkModeColors() {
            const defaults = {
                'darkBgbody': '#1a1a1a',
                'darkBgcard': '#2d2d2d',
                'darkBgsurface': '#404040',
                'darkText': '#ffffff',
                'darkTextmuted': '#adb5bd',
                'darkBorder': '#495057'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                document.getElementById(id).value = value;
                document.getElementById(id + 'Text').value = value;
            });
            
            updateDarkModePreview();
        }
        
        function updateFontPreview() {
            const fontSize = document.getElementById('fontSize').value;
            const preview = document.getElementById('fontPreview');
            
            const fontSizes = {
                'small': '14px',
                'normal': '16px',
                'large': '18px',
                'extra-large': '20px'
            };
            
            preview.style.fontSize = fontSizes[fontSize];
        }
        
        function updateLivePreview() {
            const darkMode = document.getElementById('darkModeToggle').checked;
            const highContrast = document.getElementById('highContrastToggle').checked;
            const fontSize = document.getElementById('fontSize').value;
            const container = document.getElementById('previewContainer');
            
            // Apply dark mode
            if (darkMode) {
                container.classList.add('dark-preview');
                document.documentElement.setAttribute('data-bs-theme', 'dark');
            } else {
                container.classList.remove('dark-preview');
                document.documentElement.setAttribute('data-bs-theme', 'light');
            }
            
            // Apply font size
            const fontSizes = {
                'small': '14px',
                'normal': '16px',
                'large': '18px',
                'extra-large': '20px'
            };
            container.style.fontSize = fontSizes[fontSize];
            
            // Apply high contrast
            if (highContrast) {
                container.style.filter = 'contrast(1.5)';
            } else {
                container.style.filter = 'none';
            }
            
            // Apply theme colors dynamically
            applyThemeColors();
            
            // Update chart if it exists
            if (previewChart) {
                updatePreviewChart();
            }
        }
        
        function applyThemeColors() {
            const container = document.getElementById('previewContainer');
            
            // Get current theme colors
            let primaryColor = '#0d6efd';
            let secondaryColor = '#6c757d';
            let successColor = '#198754';
            let dangerColor = '#dc3545';
            let warningColor = '#ffc107';
            let infoColor = '#0dcaf0';
            
            // Theme color schemes
            const themeColors = {
                'default': {
                    primary: '#0d6efd',
                    secondary: '#6c757d',
                    success: '#198754',
                    danger: '#dc3545',
                    warning: '#ffc107',
                    info: '#0dcaf0'
                },
                'emerald': {
                    primary: '#10b981',
                    secondary: '#059669',
                    success: '#22c55e',
                    danger: '#ef4444',
                    warning: '#f59e0b',
                    info: '#06b6d4'
                },
                'purple': {
                    primary: '#8b5cf6',
                    secondary: '#7c3aed',
                    success: '#22c55e',
                    danger: '#ef4444',
                    warning: '#f59e0b',
                    info: '#06b6d4'
                },
                'amber': {
                    primary: '#f59e0b',
                    secondary: '#d97706',
                    success: '#22c55e',
                    danger: '#ef4444',
                    warning: '#eab308',
                    info: '#06b6d4'
                }
            };
            
            // Apply theme colors
            if (selectedTheme === 'custom') {
                // Use custom colors if available
                primaryColor = document.getElementById('customPrimary')?.value || primaryColor;
                secondaryColor = document.getElementById('customSecondary')?.value || secondaryColor;
                successColor = document.getElementById('customSuccess')?.value || successColor;
                dangerColor = document.getElementById('customDanger')?.value || dangerColor;
                warningColor = document.getElementById('customWarning')?.value || warningColor;
                infoColor = document.getElementById('customInfo')?.value || infoColor;
            } else if (themeColors[selectedTheme]) {
                const colors = themeColors[selectedTheme];
                primaryColor = colors.primary;
                secondaryColor = colors.secondary;
                successColor = colors.success;
                dangerColor = colors.danger;
                warningColor = colors.warning;
                infoColor = colors.info;
            }
            
            // Apply colors to CSS custom properties in the preview container
            const style = document.createElement('style');
            style.id = 'preview-theme-style';
            
            // Remove existing preview style if it exists
            const existingStyle = document.getElementById('preview-theme-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create dynamic CSS for preview
            style.textContent = `
                #previewContainer {
                    --bs-primary: ${primaryColor};
                    --bs-secondary: ${secondaryColor};
                    --bs-success: ${successColor};
                    --bs-danger: ${dangerColor};
                    --bs-warning: ${warningColor};
                    --bs-info: ${infoColor};
                }
                
                #previewContainer .btn-primary {
                    background-color: ${primaryColor};
                    border-color: ${primaryColor};
                }
                
                #previewContainer .btn-outline-primary {
                    color: ${primaryColor};
                    border-color: ${primaryColor};
                }
                
                #previewContainer .btn-outline-primary:hover {
                    background-color: ${primaryColor};
                    border-color: ${primaryColor};
                    color: white;
                }
                
                #previewContainer .btn-success {
                    background-color: ${successColor};
                    border-color: ${successColor};
                }
                
                #previewContainer .btn-outline-danger {
                    color: ${dangerColor};
                    border-color: ${dangerColor};
                }
                
                #previewContainer .btn-outline-danger:hover {
                    background-color: ${dangerColor};
                    border-color: ${dangerColor};
                    color: white;
                }
                
                #previewContainer .badge.bg-primary {
                    background-color: ${primaryColor} !important;
                }
                
                #previewContainer .badge.bg-success {
                    background-color: ${successColor} !important;
                }
                
                #previewContainer .badge.bg-danger {
                    background-color: ${dangerColor} !important;
                }
                
                #previewContainer .badge.bg-warning {
                    background-color: ${warningColor} !important;
                }
                
                #previewContainer .badge.bg-info {
                    background-color: ${infoColor} !important;
                }
                
                #previewContainer .badge.bg-secondary {
                    background-color: ${secondaryColor} !important;
                }
                
                #previewContainer .alert-primary {
                    color: ${primaryColor};
                    background-color: ${primaryColor}20;
                    border-color: ${primaryColor}40;
                }
                
                #previewContainer .alert-success {
                    color: ${successColor};
                    background-color: ${successColor}20;
                    border-color: ${successColor}40;
                }
                
                #previewContainer .alert-warning {
                    color: ${warningColor};
                    background-color: ${warningColor}20;
                    border-color: ${warningColor}40;
                }
                
                #previewContainer .alert-danger {
                    color: ${dangerColor};
                    background-color: ${dangerColor}20;
                    border-color: ${dangerColor}40;
                }
                
                #previewContainer .nav-pills .nav-link.active {
                    background-color: ${primaryColor};
                    border-color: ${primaryColor};
                    color: white;
                }
                
                #previewContainer .nav-pills .nav-link {
                    color: ${primaryColor};
                }
                
                #previewContainer .nav-pills .nav-link:hover {
                    color: ${primaryColor};
                    background-color: ${primaryColor}20;
                }
                
                #previewContainer .nav-tabs .nav-link.active {
                    color: ${primaryColor};
                    border-bottom-color: ${primaryColor};
                }
                
                #previewContainer .nav-tabs .nav-link {
                    color: ${primaryColor};
                    border-color: transparent;
                    background-color: transparent;
                }
                
                #previewContainer .nav-tabs .nav-link:hover {
                    border-color: ${primaryColor}40 ${primaryColor}40 ${primaryColor}40;
                    color: ${primaryColor};
                    background-color: ${primaryColor}10;
                }
                
                #previewContainer .nav-tabs {
                    border-bottom-color: ${primaryColor}40;
                    background-color: transparent;
                }
                
                #previewContainer .page-item.active .page-link {
                    background-color: ${primaryColor};
                    border-color: ${primaryColor};
                    color: white;
                }
                
                #previewContainer .page-item .page-link {
                    background-color: transparent;
                    border-color: ${primaryColor}40;
                    color: ${primaryColor};
                }
                
                #previewContainer .page-item:hover .page-link:not(.active) {
                    background-color: ${primaryColor}15;
                    border-color: ${primaryColor};
                    color: ${primaryColor};
                }
                
                #previewContainer .page-item.disabled .page-link {
                    background-color: ${primaryColor}05;
                    border-color: ${primaryColor}20;
                    color: ${primaryColor}60;
                }
                
                #previewContainer .table {
                    color: ${primaryColor};
                    border-color: ${primaryColor}30;
                    background-color: transparent;
                }
                
                #previewContainer .table th {
                    background-color: ${primaryColor}10;
                    border-color: ${primaryColor}30;
                    color: ${primaryColor};
                    font-weight: 600;
                }
                
                #previewContainer .table td {
                    border-color: ${primaryColor}20;
                    color: ${primaryColor};
                    background-color: transparent;
                }
                
                #previewContainer .table tbody tr:hover {
                    background-color: ${primaryColor}08;
                }
                
                #previewContainer .table-striped > tbody > tr:nth-of-type(odd) {
                    background-color: ${primaryColor}05;
                }
                
                #previewContainer .progress-bar {
                    background-color: ${primaryColor};
                }
                
                #previewContainer .progress-bar.bg-success {
                    background-color: ${successColor} !important;
                }
                
                #previewContainer .progress-bar.bg-warning {
                    background-color: ${warningColor} !important;
                }
                
                #previewContainer .progress-bar.bg-danger {
                    background-color: ${dangerColor} !important;
                }
                
                #previewContainer .spinner-border.text-primary {
                    color: ${primaryColor} !important;
                }
                
                #previewContainer .spinner-border.text-success {
                    color: ${successColor} !important;
                }
                
                #previewContainer .spinner-grow.text-warning {
                    color: ${warningColor} !important;
                }
                
                #previewContainer .spinner-grow.text-danger {
                    color: ${dangerColor} !important;
                }
                
                #previewContainer .form-control:focus,
                #previewContainer .form-select:focus {
                    border-color: ${primaryColor};
                    box-shadow: 0 0 0 0.2rem ${primaryColor}40;
                }
                
                #previewContainer .form-check-input:checked {
                    background-color: ${primaryColor};
                    border-color: ${primaryColor};
                }
                
                #previewContainer blockquote {
                    border-left-color: ${primaryColor} !important;
                }
            `;
            
            document.head.appendChild(style);
            
            // Apply custom light/dark mode colors if custom theme is selected
            if (selectedTheme === 'custom') {
                applyCustomModeColors();
            }
        }
        
        function applyCustomModeColors() {
            const darkMode = document.getElementById('darkModeToggle').checked;
            const container = document.getElementById('previewContainer');
            
            let bgBody, bgCard, bgSurface, textColor, textMuted, borderColor;
            
            if (darkMode) {
                // Get custom dark mode colors
                bgBody = document.getElementById('darkModeBgBody')?.value || '#0d1117';
                bgCard = document.getElementById('darkModeBgCard')?.value || '#161b22';
                bgSurface = document.getElementById('darkModeBgSurface')?.value || '#21262d';
                textColor = document.getElementById('darkModeText')?.value || '#f0f6fc';
                textMuted = document.getElementById('darkModeTextMuted')?.value || '#8b949e';
                borderColor = document.getElementById('darkModeBorder')?.value || '#30363d';
            } else {
                // Get custom light mode colors
                bgBody = document.getElementById('lightModeBgBody')?.value || '#ffffff';
                bgCard = document.getElementById('lightModeBgCard')?.value || '#ffffff';
                bgSurface = document.getElementById('lightModeBgSurface')?.value || '#f8f9fa';
                textColor = document.getElementById('lightModeText')?.value || '#212529';
                textMuted = document.getElementById('lightModeTextMuted')?.value || '#6c757d';
                borderColor = document.getElementById('lightModeBorder')?.value || '#dee2e6';
            }
            
            // Apply custom mode colors
            const customModeStyle = document.createElement('style');
            customModeStyle.id = 'preview-custom-mode-style';
            
            // Remove existing custom mode style if it exists
            const existingCustomModeStyle = document.getElementById('preview-custom-mode-style');
            if (existingCustomModeStyle) {
                existingCustomModeStyle.remove();
            }
            
            customModeStyle.textContent = `
                #previewContainer {
                    background-color: ${bgBody} !important;
                    color: ${textColor} !important;
                }
                
                #previewContainer .preview-card {
                    background-color: ${bgCard} !important;
                    border-color: ${borderColor} !important;
                    color: ${textColor} !important;
                }
                
                #previewContainer .text-muted {
                    color: ${textMuted} !important;
                }
                
                #previewContainer .form-control,
                #previewContainer .form-select {
                    background-color: ${bgSurface} !important;
                    border-color: ${borderColor} !important;
                    color: ${textColor} !important;
                }
                
                #previewContainer .table {
                    color: ${textColor} !important;
                }
                
                #previewContainer .table th,
                #previewContainer .table td {
                    border-color: ${borderColor} !important;
                }
                
                #previewContainer .dropdown-menu {
                    background-color: ${bgCard} !important;
                    border-color: ${borderColor} !important;
                }
                
                #previewContainer .dropdown-item {
                    color: ${textColor} !important;
                }
                
                #previewContainer .dropdown-item:hover {
                    background-color: ${bgSurface} !important;
                }
            `;
            
            document.head.appendChild(customModeStyle);
        }
        
        function getCustomColors() {
            if (selectedTheme !== 'custom') return {};
            
            return {
                primary: document.getElementById('customPrimary').value,
                primary_hover: document.getElementById('customPrimaryHover').value,
                secondary: document.getElementById('customSecondary').value,
                success: document.getElementById('customSuccess').value,
                danger: document.getElementById('customDanger').value,
                warning: document.getElementById('customWarning').value,
                info: document.getElementById('customInfo').value
            };
        }

        function setupLightModeEventListeners() {
            const lightModeInputs = ['BgBody', 'BgCard', 'BgSurface', 'Text', 'TextMuted', 'Border'];
            
            lightModeInputs.forEach(element => {
                const colorInput = document.getElementById('lightMode' + element);
                const textInput = document.getElementById('lightMode' + element + 'Text');
                
                if (colorInput && textInput) {
                    // Sync color picker with text input
                    colorInput.addEventListener('input', (e) => {
                        textInput.value = e.target.value;
                        updateLightModePreview();
                        updateLivePreview(); // Update live preview
                    });
                    
                    // Sync text input with color picker
                    textInput.addEventListener('input', (e) => {
                        if (isValidHexColor(e.target.value)) {
                            colorInput.value = e.target.value;
                            updateLightModePreview();
                            updateLivePreview(); // Update live preview
                        }
                    });
                }
            });
        }

        function setupDarkModeEventListeners() {
            const darkModeInputs = ['BgBody', 'BgCard', 'BgSurface', 'Text', 'TextMuted', 'Border'];
            
            darkModeInputs.forEach(element => {
                const colorInput = document.getElementById('darkMode' + element);
                const textInput = document.getElementById('darkMode' + element + 'Text');
                
                if (colorInput && textInput) {
                    // Sync color picker with text input
                    colorInput.addEventListener('input', (e) => {
                        textInput.value = e.target.value;
                        updateDarkModePreview();
                        updateLivePreview(); // Update live preview
                    });
                    
                    // Sync text input with color picker
                    textInput.addEventListener('input', (e) => {
                        if (isValidHexColor(e.target.value)) {
                            colorInput.value = e.target.value;
                            updateDarkModePreview();
                            updateLivePreview(); // Update live preview
                        }
                    });
                }
            });
        }

        function updateLightModePreview() {
            // Update light mode preview if needed
            // This function can be enhanced to show live preview of light mode colors
        }

        function updateDarkModePreview() {
            // Update dark mode preview if needed
            // This function can be enhanced to show live preview of dark mode colors
        }

        function resetLightModeColors() {
            const defaults = {
                'lightModeBgBody': '#ffffff',
                'lightModeBgCard': '#ffffff',
                'lightModeBgSurface': '#f8f9fa',
                'lightModeText': '#212529',
                'lightModeTextMuted': '#6c757d',
                'lightModeBorder': '#dee2e6'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                document.getElementById(id).value = value;
                document.getElementById(id + 'Text').value = value;
            });
            
            updateLightModePreview();
        }

        function resetDarkModeColors() {
            const defaults = {
                'darkModeBgBody': '#0d1117',
                'darkModeBgCard': '#161b22',
                'darkModeBgSurface': '#21262d',
                'darkModeText': '#f0f6fc',
                'darkModeTextMuted': '#8b949e',
                'darkModeBorder': '#30363d'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                document.getElementById(id).value = value;
                document.getElementById(id + 'Text').value = value;
            });
            
            updateDarkModePreview();
        }

        function getCustomLightModeColors() {
            console.log('Getting light mode colors...'); // Debug
            const colors = {
                bg_body: document.getElementById('lightModeBgBody')?.value || '',
                bg_card: document.getElementById('lightModeBgCard')?.value || '',
                bg_surface: document.getElementById('lightModeBgSurface')?.value || '',
                text: document.getElementById('lightModeText')?.value || '',
                text_muted: document.getElementById('lightModeTextMuted')?.value || '',
                border: document.getElementById('lightModeBorder')?.value || ''
            };
            console.log('Light mode colors found:', colors); // Debug
            return colors;
        }

        function getCustomDarkModeColors() {
            console.log('Getting dark mode colors...'); // Debug
            const colors = {
                bg_body: document.getElementById('darkModeBgBody')?.value || '',
                bg_card: document.getElementById('darkModeBgCard')?.value || '',
                bg_surface: document.getElementById('darkModeBgSurface')?.value || '',
                text: document.getElementById('darkModeText')?.value || '',
                text_muted: document.getElementById('darkModeTextMuted')?.value || '',
                border: document.getElementById('darkModeBorder')?.value || ''
            };
            console.log('Dark mode colors found:', colors); // Debug
            return colors;
        }
        
        async function saveThemeSettings() {
            console.log('Save button clicked!'); // Debug
            const darkMode = document.getElementById('darkModeToggle').checked;
            const fontSize = document.getElementById('fontSize').value;
            const highContrast = document.getElementById('highContrastToggle').checked;
            
            const customColors = getCustomColors();
            const customLightMode = getCustomLightModeColors();
            const customDarkMode = getCustomDarkModeColors();
            
            console.log('Custom colors:', customColors); // Debug
            console.log('Custom light mode:', customLightMode); // Debug  
            console.log('Custom dark mode:', customDarkMode); // Debug
            console.log('Section styles:', sectionStyles); // Debug
            
            const settings = {
                theme: selectedTheme,
                dark_mode: darkMode,
                font_size: fontSize,
                high_contrast: highContrast,
                custom_colors: customColors,
                custom_light_mode: customLightMode,
                custom_dark_mode: customDarkMode,
                section_styles: sectionStyles
            };
            
            console.log('Sending settings:', settings); // Debug
            
            try {
                displayStatus('Saving theme settings...', 'alert-info');
                
                const response = await fetch('/api/theme_settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    displayStatus('Theme settings saved successfully! Reloading page to apply changes...', 'alert-success');
                    // Reload the page after a short delay to apply the new theme
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    const errorData = await response.json();
                    displayStatus('Failed to save theme settings: ' + (errorData.error || 'Unknown error'), 'alert-danger');
                }
            } catch (error) {
                displayStatus('Failed to save theme settings: ' + error.message, 'alert-danger');
            }
        }
        
        function displayStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.className = `alert ${type}`;
            statusElement.textContent = message;
            statusElement.classList.remove('d-none');
            
            if (type === 'alert-success') {
                setTimeout(() => {
                    statusElement.classList.add('d-none');
                }, 5000);
            }
        }
    </script>
</body>
</html>
